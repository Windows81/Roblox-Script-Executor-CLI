import exec_base
import requests
import clr


clr.AddReference("EasyExploits")
import EasyExploits


class api_eze(exec_base.exec_api):
    def __init__(self):
        self.ex = EasyExploits.Module()
        self.ex.LaunchExploit()
        if not self.is_attached():
            raise RuntimeError("Unable to inject EasyExploits API.")

    def exec(self, script: str):
        if not self.is_attached():
            raise RuntimeError("EasyExploits API is not injected.")
        return self.ex.ExecuteScript(script)

    def is_attached(self):
        return self.ex.isInjected()


class api_eze_dll(exec_base.api_inj, exec_base.api_upd):
    FILE_PATH = "EasyExploitsDLL.dll"
    MODULE_URL = "https://easyexploits.com/Module"

    def exec(self, script: str):
        self._write_pipe(script, "ocybedam")

    def update(self):
        data = requests.get(self.MODULE_URL).content.splitlines()
        if data[2] != "true":
            raise FileNotFoundError()

        url = data[0]
        with open(self.FILE_PATH, "wb") as f:
            f.write(requests.get(url).content)
